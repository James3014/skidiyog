<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAQ åµŒå…¥æ¸¬è©¦ - å¾ faq.diy.ski è¼‰å…¥</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif;
            line-height: 1.6; color: #333; background: #f5f5f5;
        }
        .test-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white; padding: 40px 20px; text-align: center;
        }
        .test-header h1 { font-size: 36px; margin-bottom: 10px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        .faq-embed-container {
            margin: 40px 0; background: #f8f9fa;
            border-radius: 8px; padding: 30px;
        }
        .faq-embed-header {
            color: #2c3e50; font-size: 28px; margin-bottom: 30px;
            padding-bottom: 15px; border-bottom: 3px solid #3498db;
        }
        .faq-embed-item {
            margin-bottom: 20px; background: white; border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden;
            transition: box-shadow 0.3s ease;
        }
        .faq-embed-item:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .faq-embed-badge {
            display: inline-block; background: #e3f2fd; color: #1565c0;
            padding: 8px 16px; margin: 15px 0 0 20px; border-radius: 12px; font-size: 14px;
        }
        .faq-embed-question {
            padding: 20px; cursor: pointer; display: flex;
            justify-content: space-between; align-items: center;
            font-weight: 500; font-size: 18px; color: #2c3e50;
            transition: background-color 0.3s ease;
        }
        .faq-embed-question:hover { background: #ecf0f1; }
        .faq-embed-question::before {
            content: "Q"; display: inline-block; width: 30px; height: 30px;
            line-height: 30px; text-align: center; background: #3498db;
            color: white; border-radius: 50%; margin-right: 15px;
            font-weight: bold; flex-shrink: 0;
        }
        .faq-embed-icon {
            font-size: 24px; color: #3498db;
            transition: transform 0.3s ease; flex-shrink: 0;
        }
        .faq-embed-item.active .faq-embed-icon { transform: rotate(180deg); }
        .faq-embed-answer {
            max-height: 0; overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0 20px;
        }
        .faq-embed-item.active .faq-embed-answer {
            max-height: 2000px; padding: 0 20px 20px 65px;
        }
        .faq-embed-answer p { line-height: 1.8; color: #555; margin: 10px 0; }
        .faq-embed-link {
            display: inline-block; margin-top: 10px; color: #3498db;
            text-decoration: none; font-size: 14px;
        }
        .faq-embed-link:hover { text-decoration: underline; }
        .faq-embed-loading {
            text-align: center; padding: 40px; color: #999;
        }
        .test-section {
            background: white; margin: 40px auto; padding: 40px;
            border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .highlight-box {
            background: #fff3cd; border-left: 4px solid #ffc107;
            padding: 15px; margin: 20px 0; border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ”— FAQ åµŒå…¥å…ƒä»¶æ¸¬è©¦</h1>
        <p>å¾ https://faq.diy.ski/ è¼‰å…¥ FAQ å€å¡Š - ä¿ç•™ SEO å„ªåŒ–èˆ‡çµæ§‹åŒ–è³‡æ–™</p>
    </div>

    <div class="container">
        <div class="test-section">
            <div class="highlight-box">
                <strong>âš ï¸ æ¸¬è©¦èªªæ˜ï¼š</strong> æ­¤é é¢æœƒå¾ <code>https://faq.diy.ski/faq/</code> æŠ“å–ä»¥ä¸‹ FAQï¼š
                <ul style="margin-top: 10px; margin-left: 20px;">
                    <li>faq.general.009 - å¹¾æ­²å¯ä»¥é–‹å§‹å­¸æ»‘é›ªï¼Ÿ</li>
                    <li>faq.general.010 - ï¼ˆç¬¬äºŒå€‹ FAQï¼‰</li>
                    <li>faq.general.011 - ï¼ˆç¬¬ä¸‰å€‹ FAQï¼‰</li>
                </ul>
            </div>
        </div>

        <div class="faq-embed-container">
            <h3 class="faq-embed-header">å¸¸è¦‹å•é¡Œ</h3>
            <div id="faq-embed-content" class="faq-embed-loading">
                è¼‰å…¥ä¸­...
            </div>
        </div>
    </div>

    <script>
    (async function() {
        const faqIds = ['faq.general.009', 'faq.general.010', 'faq.general.011'];
        const lang = 'zh';
        const faqBaseUrl = 'https://faq.diy.ski/faq';

        const container = document.getElementById('faq-embed-content');

        try {
            const faqs = await Promise.all(
                faqIds.map(id => fetchFAQData(id, lang))
            );

            renderFAQs(faqs);
            attachEventListeners();
        } catch (error) {
            console.error('Failed to load FAQs:', error);
            container.innerHTML = '<p style="color: #e74c3c;">è¼‰å…¥ FAQ å¤±æ•—ï¼š' + error.message + '</p>';
        }

        async function fetchFAQData(faqId, lang) {
            const url = `${faqBaseUrl}/${faqId}-${lang}.html`;
            console.log('Fetching:', url);

            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(`Failed to fetch ${faqId}: ${response.status}`);
            }

            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            const question = doc.querySelector('h1')?.textContent || '';
            const badge = doc.querySelector('.badge')?.textContent || '';
            const mainAnswer = doc.querySelector('.faq-content p')?.innerHTML || '';
            const faqUrl = `${faqBaseUrl}/${faqId}?lang=${lang}`;

            const ldJson = doc.querySelector('script[type="application/ld+json"]');
            let schemaData = null;
            if (ldJson) {
                try {
                    schemaData = JSON.parse(ldJson.textContent);
                } catch (e) {
                    console.warn('Failed to parse ld+json for', faqId);
                }
            }

            console.log('âœ… Loaded FAQ:', faqId, question);

            return {
                id: faqId,
                question,
                answer: mainAnswer,
                badge,
                url: faqUrl,
                schemaData
            };
        }

        function renderFAQs(faqs) {
            const html = faqs.map((faq, index) => `
                <div class="faq-embed-item" data-faq-index="${index}">
                    ${faq.badge ? `<div class="faq-embed-badge">${escapeHtml(faq.badge)}</div>` : ''}
                    <div class="faq-embed-question">
                        <span>${escapeHtml(faq.question)}</span>
                        <i class="material-icons faq-embed-icon">expand_more</i>
                    </div>
                    <div class="faq-embed-answer">
                        <div>${faq.answer}</div>
                        <a href="${faq.url}" class="faq-embed-link" target="_blank" rel="noopener">
                            æŸ¥çœ‹å®Œæ•´èªªæ˜ â†’
                        </a>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
            injectSchemaData(faqs);
        }

        function attachEventListeners() {
            const faqItems = container.querySelectorAll('.faq-embed-item');
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-embed-question');
                question.addEventListener('click', function() {
                    item.classList.toggle('active');
                });
            });
        }

        function injectSchemaData(faqs) {
            const validSchemas = faqs.map(faq => faq.schemaData).filter(Boolean);

            if (validSchemas.length === 0) return;

            const combinedSchema = {
                "@context": "https://schema.org",
                "@type": "FAQPage",
                "mainEntity": validSchemas.flatMap(schema =>
                    schema.mainEntity || []
                )
            };

            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(combinedSchema);
            document.head.appendChild(script);

            console.log('âœ… Injected Schema.org FAQPage data:', combinedSchema.mainEntity.length, 'questions');
            console.log('Schema data:', combinedSchema);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    })();

    // æª¢æŸ¥ Schema.org è³‡æ–™æ˜¯å¦æˆåŠŸæ³¨å…¥
    setTimeout(() => {
        const schemas = document.querySelectorAll('script[type="application/ld+json"]');
        console.log('ğŸ“Š Total Schema.org scripts found:', schemas.length);
        schemas.forEach((script, index) => {
            try {
                const data = JSON.parse(script.textContent);
                console.log(`Schema ${index + 1}:`, data);
            } catch (e) {
                console.warn(`Failed to parse schema ${index + 1}`);
            }
        });
    }, 3000);
    </script>
</body>
</html>
